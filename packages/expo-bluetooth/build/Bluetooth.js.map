{"version":3,"file":"Bluetooth.js","sourceRoot":"","sources":["../src/Bluetooth.ts"],"names":[],"mappings":"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","sourcesContent":["import BluetoothPlatformError from './errors/BluetoothPlatformError';\nimport AndroidGATTError from './errors/AndroidGATTError';\nimport { Platform, Subscription } from 'expo-core';\n\nimport {\n  Base64,\n  Priority,\n  Central,\n  CentralState,\n  CharacteristicProperty,\n  Identifier,\n  NativeAdvertismentData,\n  NativeBluetoothElement,\n  NativeCharacteristic,\n  NativeDescriptor,\n  NativeError,\n  NativeEventData,\n  NativePeripheral,\n  NativeService,\n  PeripheralFoundCallback,\n  PeripheralState,\n  ScanSettings,\n  StateUpdatedCallback,\n  TransactionId,\n  TransactionType,\n  UUID,\n  WriteCharacteristicOptions,\n} from './Bluetooth.types';\nimport { BLUETOOTH_EVENT, DELIMINATOR, EVENTS, TYPES } from './BluetoothConstants';\nimport {\n  addHandlerForKey,\n  addListener,\n  fireMultiEventHandlers,\n  fireSingleEventHandlers,\n  firePeripheralObservers,\n  addHandlerForID,\n  getHandlersForKey,\n  resetHandlersForKey,\n  _resetAllHandlers,\n} from './BluetoothEventHandler';\nimport { invariantAvailability, invariant, invariantUUID } from './errors/BluetoothInvariant';\nimport { clearPeripherals, getPeripherals, updateStateWithPeripheral } from './BluetoothLocalState';\nimport { peripheralIdFromId } from './BluetoothTransactions';\nimport ExpoBluetoothModule from './ExpoBluetooth';\nimport Transaction from './Transaction';\n\nimport BluetoothError from './errors/BluetoothError';\n\nexport * from './Bluetooth.types';\n\nexport { default as AndroidGATTError } from './errors/AndroidGATTError';\nexport { default as BluetoothError } from './errors/BluetoothError';\nexport { default as BluetoothInvariant } from './errors/BluetoothInvariant';\nexport { default as BluetoothPlatformError } from './errors/BluetoothPlatformError';\n\nfunction platformModuleWithCustomErrors(platformModule: { [property: string]: any } ): { [property: string]: any } {\n  const platform = {};\n  for (const property of Object.keys(platformModule)) {\n    if (typeof platformModule[property] !== 'function') {\n      Object.defineProperty(platform, property, {\n        get() {\n          return platformModule[property];\n        }\n      });\n    } else {\n      platform[property] = methodWithTransformedError(platformModule[property], property);\n    }\n  }\n  Object.freeze(platform);\n  return platform;\n}\n\nfunction methodWithTransformedError(method: (...props:any[]) => Promise<any>, methodName: string): ((...props: any[]) => Promise<any>) {\n  /** Stack trace without async layers */\n  const stack = decodeURI(new Error().stack || \"\");\n  return async (...props: any[]): Promise<any> => {\n    try {\n      console.log(`EXBLE: invoke: ${methodName}()`);\n      return await method(...props);\n    } catch ({ message, code, ...props }) {\n      if (code.indexOf('ERR_BLE_GATT:') > -1 ) {\n        const gattStatusCode = code.split(':')[1];\n        throw new AndroidGATTError({ gattStatusCode, stack, invokedMethod: methodName });\n      } \n      throw new BluetoothPlatformError({ message, code, ...props, invokedMethod: methodName, stack });\n    }\n  };\n}\n\nexport function _getGATTStatusError(code, invokedMethod, stack = undefined) {\n  const nStack = stack || new Error().stack;\n  if (code.indexOf('ERR_BLE_GATT:') > -1 ) {\n    const gattStatusCode = code.split(':')[1];\n    return new AndroidGATTError({ gattStatusCode, stack: nStack, invokedMethod });\n  } \n  return null;\n}\n\nconst ExpoBluetooth = platformModuleWithCustomErrors(ExpoBluetoothModule);\n\nexport { BLUETOOTH_EVENT, TYPES, EVENTS };\n\ntype ScanOptions = {\n  serviceUUIDsToQuery?: string[];\n  androidScanMode?: any;\n  androidMatchMode?: any;\n  /**\n   * Match as many advertisement per filter as hw could allow\n   * dependes on current capability and availability of the resources in hw.\n   */\n  androidNumberOfMatches?: any;\n  /** Oreo (26)+ */\n  androidOnlyConnectable?: boolean;\n};\n\ntype CancelScanningCallback = () => void;\n/**\n * **iOS:**\n *\n * Although strongly discouraged,\n * if `serviceUUIDsToQuery` is `null | undefined` all discovered peripherals will be returned.\n * If the central is already scanning with different\n * `serviceUUIDsToQuery` or `scanSettings`, the provided parameters will replace them.\n */\nexport async function startScanningAsync(\n  scanSettings: ScanOptions = {},\n  callback: (peripheral: NativePeripheral) => void\n): Promise<CancelScanningCallback> {\n  invariantAvailability('startScanningAsync');\n  invariant(callback, 'startScanningAsync({ ... }, null): callback is not defined');\n\n  const { serviceUUIDsToQuery = [], ...scanningOptions } = scanSettings;\n  \n  await ExpoBluetooth.startScanningAsync([...new Set(serviceUUIDsToQuery)], scanningOptions);\n\n  const subscription = addHandlerForKey(EVENTS.CENTRAL_DISCOVERED_PERIPHERAL, event => {\n    invariant(callback, 'startScanningAsync({ ... }, null): callback is not defined');\n    if (!event) {\n      throw new Error('UNEXPECTED ' + EVENTS.CENTRAL_DISCOVERED_PERIPHERAL);\n    }\n    callback(event.peripheral);\n  });\n\n  return async () => {\n    if (subscription) {\n      subscription.remove();\n      await stopScanningAsync();\n    }\n  };\n}\n\nexport async function stopScanningAsync(): Promise<void> {\n  invariantAvailability('stopScanningAsync');\n  // Remove all callbacks\n  await resetHandlersForKey(EVENTS.CENTRAL_DISCOVERED_PERIPHERAL);\n  await ExpoBluetooth.stopScanningAsync();\n}\n\n// Avoiding using \"start\" in passive method names\nexport function observeUpdates(callback: (updates: any) => void): Subscription {\n  return addHandlerForKey('everything', callback);\n}\n\n// export function observeScanningErrors(callback: (updates: any) => void): Subscription {\n//   return addHandlerForKey(EVENTS.CENTRAL_SCAN_STOPPED, callback);\n// }\n\nexport async function observeStateAsync(callback: StateUpdatedCallback): Promise<Subscription> {\n  const central = await getCentralAsync();\n  // Make the callback async so the subscription returns first.\n  setTimeout(() => callback(central.state));\n  return addHandlerForKey(EVENTS.CENTRAL_STATE_CHANGED, ({ central = {} }) => callback(central.state) );\n}\n\nexport async function connectAsync(\n  peripheralUUID: UUID,\n  options: {\n    timeout?: number;\n    options?: any;\n    onDisconnect?: any;\n  } = {}\n): Promise<NativePeripheral> {\n  invariantAvailability('connectPeripheralAsync');\n  invariantUUID(peripheralUUID);\n\n  const { onDisconnect } = options;\n  if (onDisconnect) {\n    addHandlerForID(EVENTS.PERIPHERAL_DISCONNECTED, peripheralUUID, onDisconnect);\n  }\n\n  let timeoutTag: number | undefined;\n\n  return new Promise(async (resolve, reject) => {\n    if (options.timeout) {\n      timeoutTag = setTimeout(() => {\n        disconnectAsync(peripheralUUID);\n        reject(\n          new BluetoothError({\n            message: `Failed to connect to peripheral: ${peripheralUUID} in under: ${\n              options.timeout\n            }ms`,\n            code: 'ERR_BLE_TIMEOUT',\n          })\n        );\n      }, options.timeout);\n    }\n    \n    try {\n      const result = await ExpoBluetooth.connectPeripheralAsync(peripheralUUID, options.options);\n      console.log(\"API:INTERNAL:connectPeripheralAsync.resolved\", result)\n      clearTimeout(timeoutTag);\n      resolve(result);\n      return;\n    } catch (error) {\n      console.log(\"API:INTERNAL:connectPeripheralAsync.rejected\", error)\n      clearTimeout(timeoutTag);\n      reject(error);\n      return;\n    }\n  });\n}\n\n/** This method will also cancel pending connections */\nexport async function disconnectAsync(peripheralUUID: UUID): Promise<any> {\n  invariantAvailability('disconnectPeripheralAsync');\n  invariantUUID(peripheralUUID);\n  return await ExpoBluetooth.disconnectPeripheralAsync(peripheralUUID);\n}\n\n/* TODO: Bacon: Add a return type */\nexport async function readDescriptorAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  descriptorUUID,\n}: any): Promise<Base64 | undefined> {\n  const { descriptor } = await ExpoBluetooth.readDescriptorAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    descriptorUUID,\n    characteristicProperties: CharacteristicProperty.Read,\n  });\n\n  return descriptor.value;\n}\n\n/* TODO: Bacon: Add a return type */\nexport async function writeDescriptorAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  descriptorUUID,\n  data,\n}: any): Promise<any> {\n  invariantAvailability('writeDescriptorAsync');\n  const { descriptor } = await ExpoBluetooth.writeDescriptorAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    descriptorUUID,\n    data,\n    characteristicProperties: CharacteristicProperty.Write,\n  });\n  return descriptor;\n}\nexport async function setNotifyCharacteristicAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  shouldNotify,\n}: any): Promise<NativeCharacteristic> {\n  invariantAvailability('setNotifyCharacteristicAsync');\n\n  const { characteristic } = await ExpoBluetooth.setNotifyCharacteristicAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    shouldNotify,\n  });\n  return characteristic;\n}\n\n/* TODO: Bacon: Add a return type */\nexport async function readCharacteristicAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n}: any): Promise<Base64 | null> {\n  const { characteristic } = await ExpoBluetooth.readCharacteristicAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    characteristicProperties: CharacteristicProperty.Read,\n  });\n\n  return characteristic.value;\n}\n\n/* TODO: Bacon: Add a return type */\nexport async function writeCharacteristicAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  data,\n}: any): Promise<NativeCharacteristic> {\n  const { characteristic } = await ExpoBluetooth.writeCharacteristicAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    data,\n    characteristicProperties: CharacteristicProperty.Write,\n  });\n  return characteristic;\n}\n\n/* TODO: Bacon: Why would anyone use this? */\n/* TODO: Bacon: Test if this works */\n/* TODO: Bacon: Add a return type */\nexport async function writeCharacteristicWithoutResponseAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  data,\n}: WriteCharacteristicOptions): Promise<NativeCharacteristic> {\n  const { characteristic } = await ExpoBluetooth.writeCharacteristicAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    data,\n    characteristicProperties: CharacteristicProperty.WriteWithoutResponse,\n  });\n  return characteristic;\n}\n\nexport async function readRSSIAsync(peripheralUUID: UUID): Promise<number> {\n  invariantAvailability('readRSSIAsync');\n  invariantUUID(peripheralUUID);\n  return await ExpoBluetooth.readRSSIAsync(peripheralUUID);\n}\n\nexport async function getPeripheralsAsync(): Promise<any[]> {\n  invariantAvailability('getPeripheralsAsync');\n  return await ExpoBluetooth.getPeripheralsAsync();\n}\n\nexport async function getConnectedPeripheralsAsync(\n  serviceUUIDsToQuery: UUID[] = []\n): Promise<NativePeripheral[]> {\n  invariantAvailability('getConnectedPeripheralsAsync');\n  return await ExpoBluetooth.getConnectedPeripheralsAsync(serviceUUIDsToQuery);\n}\n\nexport async function getCentralAsync(): Promise<any> {\n  invariantAvailability('getCentralAsync');\n  return await ExpoBluetooth.getCentralAsync();\n}\n\nexport async function getPeripheralAsync({ peripheralUUID }): Promise<any[]> {\n  invariantAvailability('getPeripheralAsync');\n  return await ExpoBluetooth.getPeripheralAsync({ peripheralUUID });\n}\nexport async function getServiceAsync({ peripheralUUID, serviceUUID }): Promise<any[]> {\n  invariantAvailability('getServiceAsync');\n  return await ExpoBluetooth.getServiceAsync({ peripheralUUID, serviceUUID });\n}\nexport async function getCharacteristicAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n}): Promise<any[]> {\n  invariantAvailability('getCharacteristicAsync');\n  return await ExpoBluetooth.getCharacteristicAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n  });\n}\n\nexport async function getDescriptorAsync({\n  peripheralUUID,\n  serviceUUID,\n  characteristicUUID,\n  descriptorUUID,\n}): Promise<any[]> {\n  invariantAvailability('getDescriptorAsync');\n  return await ExpoBluetooth.getDescriptorAsync({\n    peripheralUUID,\n    serviceUUID,\n    characteristicUUID,\n    descriptorUUID,\n  });\n}\n\nexport async function isScanningAsync(): Promise<any> {\n  const { isScanning } = await getCentralAsync();\n  return isScanning;\n}\n\n// TODO: Bacon: Add serviceUUIDs\nexport async function discoverServicesForPeripheralAsync(options: {\n  id: string;\n  serviceUUIDs?: UUID[];\n  characteristicProperties?: CharacteristicProperty;\n}): Promise<{ peripheral: NativePeripheral }> {\n  invariantAvailability('discoverServicesForPeripheralAsync');\n  const transaction = Transaction.fromTransactionId(options.id);\n  console.log(\"discoverServicesForPeripheralAsync: Before Native: \", options)\n  return await ExpoBluetooth.discoverServicesForPeripheralAsync({\n    ...transaction.getUUIDs(),\n    serviceUUIDs: options.serviceUUIDs,\n    characteristicProperties: options.characteristicProperties,\n  });\n}\n\nexport async function discoverIncludedServicesForServiceAsync(options: {\n  id: string;\n  serviceUUIDs?: UUID[];\n}): Promise<{ peripheral: NativePeripheral }> {\n  invariantAvailability('discoverIncludedServicesForServiceAsync');\n  const transaction = Transaction.fromTransactionId(options.id);\n  return await ExpoBluetooth.discoverIncludedServicesForServiceAsync({\n    ...transaction.getUUIDs(),\n    serviceUUIDs: options.serviceUUIDs,\n  });\n}\n\nexport async function discoverCharacteristicsForServiceAsync(options: {\n  id: string;\n  serviceUUIDs?: UUID[];\n  characteristicProperties?: CharacteristicProperty;\n}): Promise<{ service: NativeService }> {\n  invariantAvailability('discoverCharacteristicsForServiceAsync');\n  const transaction = Transaction.fromTransactionId(options.id);\n  return await ExpoBluetooth.discoverCharacteristicsForServiceAsync({\n    ...transaction.getUUIDs(),\n    serviceUUIDs: options.serviceUUIDs,\n    characteristicProperties: options.characteristicProperties,\n  });\n}\n\nexport async function discoverDescriptorsForCharacteristicAsync(options: {\n  id: string;\n  serviceUUIDs?: UUID[];\n  characteristicProperties?: CharacteristicProperty;\n}): Promise<{ peripheral: NativePeripheral; characteristic: NativeCharacteristic }> {\n  invariantAvailability('discoverDescriptorsForCharacteristicAsync');\n  const transaction = Transaction.fromTransactionId(options.id);\n  return await ExpoBluetooth.discoverDescriptorsForCharacteristicAsync({\n    ...transaction.getUUIDs(),\n    serviceUUIDs: options.serviceUUIDs,\n    characteristicProperties: options.characteristicProperties,\n  });\n  // return await discoverAsync({ id });\n}\n\nexport async function loadPeripheralAsync(\n  { id },\n  skipConnecting: boolean = false\n): Promise<NativePeripheral> {\n  const peripheralId = peripheralIdFromId(id);\n  const peripheral = getPeripherals()[peripheralId];\n  if (!peripheral) {\n    throw new Error('Not a peripheral ' + peripheralId);\n  }\n\n  if (peripheral.state !== 'connected') {\n    if (!skipConnecting) {\n      const connectedPeripheral = await connectAsync(peripheralId, {\n        onDisconnect: (...props) => {\n          console.log('On Disconnect public callback', ...props);\n        },\n      });\n      console.log('loadPeripheralAsync(): connected!');\n      return loadPeripheralAsync(connectedPeripheral, true);\n    }\n    console.log('loadPeripheralAsync(): NEVER CALL', peripheral.state);\n    // This should never be called because in theory connectAsync would throw an error.\n  } else if (peripheral.state === 'connected') {\n    console.log('loadPeripheralAsync(): _loadChildrenRecursivelyAsync!');\n    await _loadChildrenRecursivelyAsync({ id: peripheralId });\n  }\n  console.log('loadPeripheralAsync(): fully loaded');\n\n  // In case any updates occured during this function.\n  return getPeripherals()[peripheralId];\n}\n\nexport async function _loadChildrenRecursivelyAsync({ id }): Promise<any[]> {\n  const components = id.split(DELIMINATOR);\n  console.log('_loadChildrenRecursivelyAsync(): components', components);\n  // console.log({ components });\n  if (components.length === 4) {\n    // Descriptor ID\n    throw new Error('Descriptors have no children');\n  } else if (components.length === 3) {\n    // Characteristic ID\n    console.log('Load Characteristic ', id);\n    // DEBUG\n\n    // console.warn('DISABLE ME');\n    // return [];\n    const {\n      characteristic: { descriptors },\n    } = await discoverDescriptorsForCharacteristicAsync({ id });\n    return descriptors;\n  } else if (components.length === 2) {\n    // Service ID\n    console.log('Load Service ', id);\n    const { service } = await discoverCharacteristicsForServiceAsync({ id });\n    console.log('LOADED CHARACTERISTICS FROM SERVICE', service);\n    return await Promise.all(\n      service.characteristics.map(characteristic => _loadChildrenRecursivelyAsync(characteristic))\n    );\n  } else if (components.length === 1) {\n    // Peripheral ID\n    console.log('Load Peripheral ', id);\n    const {\n      peripheral: { services },\n    } = await discoverServicesForPeripheralAsync({ id });\n    console.log('discoverServicesForPeripheralAsync(): ', services);\n    return await Promise.all(services.map(service => _loadChildrenRecursivelyAsync(service)));\n  } else {\n    throw new Error(`Unknown ID ${id}`);\n  }\n}\n\nconst android = {\n  async requestMTUAsync(peripheralUUID: UUID, MTU: number): Promise<number> {\n    invariantAvailability('requestMTUAsync');\n    invariantUUID(peripheralUUID);\n    if (MTU > 512) {\n      throw new BluetoothError({ message: 'Max MTU size is 512', code: 'ERR_BLE_MTU' });\n    }\n    return await ExpoBluetooth.requestMTUAsync(peripheralUUID, MTU);\n  },\n  async bondAsync(peripheralUUID: UUID): Promise<any> {\n    invariantAvailability('bondAsync');\n    invariantUUID(peripheralUUID);\n    return await ExpoBluetooth.bondAsync(peripheralUUID);\n  },\n  async unbondAsync(peripheralUUID: UUID): Promise<any> {\n    invariantAvailability('unbondAsync');\n    invariantUUID(peripheralUUID);\n    return await ExpoBluetooth.unbondAsync(peripheralUUID);\n  },\n  async enableBluetoothAsync(isBluetoothEnabled: boolean): Promise<void> {\n    invariantAvailability('enableBluetoothAsync');\n    return await ExpoBluetooth.enableBluetoothAsync(isBluetoothEnabled);\n  },\n  async getBondedPeripheralsAsync(): Promise<NativePeripheral[]> {\n    invariantAvailability('getBondedPeripheralsAsync');\n    return await ExpoBluetooth.getBondedPeripheralsAsync();\n  },\n  async requestConnectionPriorityAsync(\n    peripheralUUID: UUID,\n    connectionPriority: Priority\n  ): Promise<any> {\n    invariantAvailability('requestConnectionPriorityAsync');\n    invariantUUID(peripheralUUID);\n    return await ExpoBluetooth.requestConnectionPriorityAsync(peripheralUUID, connectionPriority);\n  },\n  observeBluetoothAvailabilty(callback: (updates: Central) => void): Subscription {\n    return addHandlerForKey(EVENTS.SYSTEM_AVAILABILITY_CHANGED, callback);\n  },\n  observeBluetoothEnabled(callback: (updates: Central) => void): Subscription {\n    return addHandlerForKey(EVENTS.SYSTEM_ENABLED_STATE_CHANGED, callback);\n  },\n};\n\nexport { android };\n\nexport async function _reset(): Promise<void> {\n  await stopScanningAsync();\n  clearPeripherals();\n  await _resetAllHandlers();\n}\n\nlet lastEvent;\naddListener(({ data, event }: { data: NativeEventData; event: string }) => {\n  const { peripheral, peripherals, central, advertisementData, RSSI, error } = data;\n\n  // console.log('GOT EVENT: ', { data, event });\n  if (event === 'UPDATE') {\n    clearPeripherals();\n    if (peripherals) {\n      for (const peripheral of peripherals) {\n        updateStateWithPeripheral(peripheral);\n      }\n    }\n    firePeripheralObservers();\n    return;\n  }\n  \n  if (event === EVENTS.PERIPHERAL_DISCOVERED_SERVICES) {\n    console.log(\"SERVICES: \", peripheral);\n  } else {\n    console.log('Event: ' + event + ((lastEvent && lastEvent !== event) ? ', last: ' + lastEvent : ''));\n    lastEvent = event;\n  }\n\n  switch (event) {\n    case EVENTS.DESCRIPTOR_DID_READ:\n    case EVENTS.DESCRIPTOR_DID_WRITE:\n    case EVENTS.CHARACTERISTIC_DID_READ:\n    case EVENTS.CHARACTERISTIC_DID_WRITE:\n    case EVENTS.CHARACTERISTIC_DID_NOTIFY:\n    case EVENTS.PERIPHERAL_DISCOVERED_SERVICES:\n    case EVENTS.SERVICE_DISCOVERED_CHARACTERISTICS:\n    case EVENTS.SERVICE_DISCOVERED_INCLUDED_SERVICES:\n    case EVENTS.CHARACTERISTIC_DISCOVERED_DESCRIPTORS:\n    case EVENTS.CHARACTERISTIC_DISCOVERED_DESCRIPTORS:\n      // noop\n      break;\n    case EVENTS.PERIPHERAL_CONNECTED:\n      console.log('Connect peripheral: ', peripheral!.id);\n      break;\n    case EVENTS.CENTRAL_STATE_CHANGED:\n    case EVENTS.PERIPHERAL_DISCONNECTED:\n    case EVENTS.CENTRAL_DISCOVERED_PERIPHERAL:\n    case EVENTS.SYSTEM_ENABLED_STATE_CHANGED:\n      fireMultiEventHandlers(event, { peripheral, central, error });\n      if (peripheral) {\n        // Send specific events for things like disconnect.\n        const uid = `${event}_${peripheral.id}`;\n        fireSingleEventHandlers(uid, { peripheral, central, error });\n      }\n      firePeripheralObservers();\n      return;\n    default:\n      throw new BluetoothError({ message: 'Unhandled event: ' + event, code: 'ERR_BLE_UNHANDLED_EVENT'});\n  }\n});\n"]}